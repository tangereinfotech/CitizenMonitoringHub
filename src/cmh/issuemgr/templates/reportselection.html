{# Copyright 2011, Tangere Infotech Pvt Ltd [http://tangere.in]                 #}
{#                                                                              #}
{# Licensed under the Apache License, Version 2.0 (the "License");              #}
{# you may not use this file except in compliance with the License.             #}
{# You may obtain a copy of the License at                                      #}
{#                                                                              #}
{#       http://www.apache.org/licenses/LICENSE-2.0                             #}
{#                                                                              #}
{# Unless required by applicable law or agreed to in writing, software          #}
{# distributed under the License is distributed on an "AS IS" BASIS,            #}
{# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.     #}
{# See the License for the specific language governing permissions and          #}
{# limitations under the License.                                               #}

{% extends "basewithmenu.html" %}
{% block page_content %}
<div style="width:100%; text-align:center;">
  <div class="report_form" align="center">
    {# {% csrf_token %} #}
    <fieldset  style="width:750px;">
      <legend>
        Duration
      </legend>
      <input type="text" id="id_stdate" name="stdate" value="{{repdata.strtdate|date:'d/m/Y'}}" readonly="readonly">
      <input type="text" id="id_endate" name="endate" value="{{repdata.enddate|date:'d/m/Y'}}" readonly="readonly">
    </fieldset>
    <fieldset  style="width:750px;">
      <legend>
        Department
      </legend>
      <table style="text-align:center;">
        <tr>
          <td>
            Departments Available<br /><br/>
            {{ form.departments }}
          </td>
          <td style="text-align:center">
            <input type = "button" value="Add" id = "btnMoveRight" onclick = "fnMoveItems('id_departments','id_selecteddep','add', {{ repdata.id }})" class="btn" style="width:80px" name="hello"><br/>
            <input type = "button" value="Remove" id = "btnMoveLeft" onclick = "fnMoveItems('id_selecteddep','id_departments','remove', {{ repdata.id }})" class="btn" style="width:80px">
          </td>
          <td>
            Departments Selected<br/><br/>
            {{ form.selecteddep }}
          </td>
        </tr>
      </table>
    </fieldset>
    <fieldset  style="width:750px;">
      <legend>
        Locations
      </legend>
      <table style="text-align:center;width:100%">
        <tr>
          <td style="text-align:left;width:20%">
            Select Block
          </td>
          <td style="width:100%">
            {{ form.block }}
          </td>
          <td style="text-align:center;width:10%">
            <input type="button" value="Add" onclick="appendRow('blk', {{ repdata.id }})" class="btn" style="width:80px">
          </td>
        </tr>
        <tr >
          <td style="text-align:left;width:20%">
            Select GramPanchayat
          </td>
          <td style="width:100%">
            {{ form.gp }}
          </td>
          <td style="text-align:center;width:10%">
            <input type="button" value="Add" onclick="appendRow('gp', {{ repdata.id }})" class="btn" style="width:80px">
          </td>
        </tr>
        <tr>
          <td style="text-align:left;width:20%">
            Select Village
          </td>
          <td style="width:100%">
            {{ form.village }}
          </td>
          <td style="text-align:center;width:10%">
            <input type="button" value="Add" onclick="appendRow('vill', {{ repdata.id }})" class="btn" style="width:80px">
          </td>
        </tr>
        <tr>
          <td style="text-align:left;width:20%">
            Selected Location Details
          </td>
          <td colspan="2" style="width:80%">
            <table class="tabularlist" id="sel_loc">
              <thead>
                <tr>
                  <th>
                    Block
                  </th>
                  <th>
                    GramPanchayat
                  </th>
                  <th>
                    Village
                  </th>
                  <th>
                    Click to remove
                  </th>
                </tr>
              </thead>
              <tbody>
                {% for b in repdata.block.all %}
                <tr>
                  <td> {{ b }} </td>
                  <td/>
                  <td/>
                  <form action="/complaint/report/" method="POST" id="formloc-" + "{{ b.id }}">
                    <td>
                      <input type="hidden" value="{{ repdata.id }}" name="repdataid">
                      <input type="hidden" value="{{ b.id }}" name="blk">
                      <input type="submit" value="Remove" name="removebutt" onclick="doTableDelete (this.parentNode.parentNode.rowIndex, {{ b.id }})" class="btn" style="width:80px">
                    </td>
                  </form>
                </tr>

                {% endfor %}
                {% for g in repdata.gp.all %}
                <tr>
                  <td> {{ g.block }} </td>
                  <td> {{ g }} </td>
                  <td/>
                  <form action="/complaint/report/" method="POST" id="formloc-" + "{{ g.id }}">
                    <td>
                      <input type="hidden" value="{{ repdata.id }}" name="repdataid">
                      <input type="hidden" value="{{ g.id }}" name="gp">
                      <input type="submit" value="Remove" name="removebutt" onclick="doTableDelete (this.parentNode.parentNode.rowIndex, {{ g.id }})" class="btn" style="width:80px">
                    </td>
                  </form>
                </tr>
                {% endfor %}
                {% for v in repdata.village.all %}
                <tr>
                  <td> {{ v.grampanchayat.block }} </td>
                  <td> {{ v.grampanchayat }} </td>
                  <td> {{ v }} </td>
                  <form action="/complaint/report/" method="POST"  id="formloc-" + "{{ v.id }}">
                    <td>
                      <input type="hidden" value="{{ repdata.id }}" name="repdataid">
                      <input type="hidden" value="{{ v.id }}" name="vill">
                      <input type="submit" value="Remove" name="removebutt" onclick="doTableDelete (this.parentNode.parentNode.rowIndex, {{ v.id }})" class="btn" style="width:80px">
                    </td>
                  </form>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </td>
        </tr>
      </table>
    </fieldset>
    <form action ="/complaint/edit_report/" method="POST">
      <table align="center" style="text-align:center;width:830px;">
        <tr>
          <td colspan="3">
            <input type="hidden" name="repdataid" value="{{ repdata.id }}">
            <input type="submit" value="View Report" name="initial_report" class="btn" />
          </td>
        </tr>
      </table>
    </form>
  </div>
</div>
<script type="text/javascript" src="/static/js/reportSelectors.js"></script>
<script type="text/javascript">
 $(document).ready (
    function () {
        $("#id_block").change(
            function(){
                $.getJSON ("/masters/getgpinblocks/",
                           {
                               repdataid : {{ repdata.id }},
                               blockid : $(this).val ()
                           },
                           function (data, status, jqXHR) {
                               var gp_dom_html = "<option value='0'>-------</option>"
                               var village_dom_html = "<option value='0'>-------</option>"
                               $.each (data.gps,
                                       function (index, gpdata) {
                                           gp_dom_html += "<option value='" + gpdata.id + "'>" + gpdata.name + "</option>"
                                       });
                               $("#id_gp").html (gp_dom_html);
                               $("#id_village").html (village_dom_html);
                           });
            });
        $("#id_gp").change(
            function() {
                $.getJSON ("/masters/getvillingps/",
                           {
                               repdataid : {{ repdata.id }},
                               gpid : $(this).val ()
                           },
                           function (data, status, jqXHR) {
                               var vill_dom_html = "<option value='0'>-------</option>"
                               $.each (data.vills,
                                       function (index, villdata) {
                                           vill_dom_html += "<option value='" + villdata.id + "'>" + villdata.name + "</option>"
                                       });
                               $("#id_village").html (vill_dom_html);
                           });
            });
    }
 );
</script>

{% endblock %}
