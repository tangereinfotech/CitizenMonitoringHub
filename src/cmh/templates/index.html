{# Copyright 2011, Tangere Infotech Pvt Ltd [http://tangere.in]                 #}
{#                                                                              #}
{# Licensed under the Apache License, Version 2.0 (the "License");              #}
{# you may not use this file except in compliance with the License.             #}
{# You may obtain a copy of the License at                                      #}
{#                                                                              #}
{#       http://www.apache.org/licenses/LICENSE-2.0                             #}
{#                                                                              #}
{# Unless required by applicable law or agreed to in writing, software          #}
{# distributed under the License is distributed on an "AS IS" BASIS,            #}
{# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.     #}
{# See the License for the specific language governing permissions and          #}
{# limitations under the License.                                               #}

{% extends "signinbase.html" %}
{% block extra_heads %}
    <meta name="viewport" content="initial-scale=0.1, user-scalable=no" />
{% endblock %}

{% block page_content %}
<div id="base_map"></div>
<div id="trending-issues-section">
  <div class="section-title">Hot Issues</div>
  <ul class="period-right">
    <li>Last:</li>
    <li><a href="javascript:update_issues_trend (1);">Week</a></li>
    <li><a href="javascript:update_issues_trend (2);">Month</a></li>
    <li><a href="javascript:update_issues_trend (3);">3 Months</a></li>
  </ul>
  <div id="trending-issues-chart"></div>
</div>
<div class="resolution-metrics">Complaint Metrics</div>
<ul class="period-right">
  <li>Last:</li>
  <li><a href="#">Week</a></li>
  <li><a href="#">Month</a></li>
  <li><a href="#">3 Months</a></li>
</ul>
<div id="issue-type-summary">
  <table id="metrics" class="tabularlist">
    <thead>
      <tr>
        <th rowspan="2" style="width:35%">Complaint Type</th>
        <th colspan="5">Number of complaint in status:</th>
      </tr>
      <tr>
        <th style="width:13%">New / Reopened </th>
        <th style="width:13%">Acknowledged </th>
        <th style="width:13%">Opened (In&nbsp;Progress) </th>
        <th style="width:13%">Resolved </th>
        <th style="width:13%">Closed </th>
      </tr>
    </thead>
    <tbody>
      {% for issue_type in issue_types %}
      <tr>
        <td> {{ issue_type.name }} </td>
        <td> {{ issue_type.new_reopened }} </td>
        <td> {{ issue_type.acknowledged }} </td>
        <td> {{ issue_type.opened }} </td>
        <td> {{ issue_type.resolved }} </td>
        <td> {{ issue_type.closed }} </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<script type="text/javascript" src="/static/jquery/js/jqplot.dateAxisRenderer.js"></script>
<script type="text/javascript" src="/static/jquery/js/jqplot.pointLabels.min.js"></script>
<script type="text/javascript" src="/static/jquery/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="/static/js/MapHandler.js"></script>
<script type="text/javascript" src="/static/js/complainthandler.js"></script>
<script type="text/javascript">
  $(document).ready (function () {
    MapHandler.init ('base_map',
                     {{ map.center_lat }},
                     {{ map.center_long }},
                     {{ map.zoom_level }},
                     function () {
                       MapHandler.update_with_stats ('/complaint/get_category_map_update/');
                     });
    update_issues_trend (1);
    $('#metrics').dataTable ({bSortable: true});
  });

  function update_issues_trend (period) {
    show_hot_complaints ("trending-issues-chart", "/complaint/hot_complaints/", period);
  }
</script>
{% endblock %}
